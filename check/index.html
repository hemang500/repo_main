<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <!-- Content to convert to PDF -->
    <div id="content">
        <h1>Invoice</h1>
        <p>This is a sample invoice content that will be converted to a PDF.</p>
    </div>

    <!-- Button to trigger the PDF generation and upload -->
    <button id="sendBill">Send Bill</button>

    <script>
        document.getElementById("sendBill").addEventListener("click", function () {
            // Select the content to convert
            const content = document.getElementById("content");

            // Generate the PDF using html2pdf
            html2pdf()
                .from(content)
                .toPdf()
                .outputPdf("datauristring") // Output as Data URI
                .then(function (pdfDataUri) {
                    // Convert Data URI to Blob
                    const pdfBlob = dataURItoBlob(pdfDataUri);

                    // Create a FormData object to send the PDF
                    const formData = new FormData();
                    formData.append("pdf", pdfBlob, "invoice.pdf");

                    // Send to the server using fetch
                    fetch("upload.php", {
                        method: "POST",
                        body: formData,
                    })
                        .then(response => response.json())
                        .then(data => console.log("File Path:", data.filePath))
                        .catch(err => console.error("Error:", err));
                });

            // Helper function to convert Data URI to Blob
            function dataURItoBlob(dataURI) {
                const byteString = atob(dataURI.split(",")[1]);
                const mimeString = dataURI.split(",")[0].split(":")[1].split(";")[0];
                const ab = new ArrayBuffer(byteString.length);
                const ia = new Uint8Array(ab);
                for (let i = 0; i < byteString.length; i++) {
                    ia[i] = byteString.charCodeAt(i);
                }
                return new Blob([ab], { type: mimeString });
            }
        });
    </script>
</body>
</html>
